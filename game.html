<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeerJS Text and Call</title>
    <script src="https://cdn.peerjs.com/1.3.1/peerjs.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        input, button {
            margin: 5px;
            padding: 10px;
        }
    </style>
</head>
<body>

    <h1>PeerJS Text and Call</h1>
    <input type="text" id="peerId" placeholder="Enter Peer ID" />
    <button id="connectButton">Connect</button>

    <div>
        <textarea id="messageInput" placeholder="Type a message..."></textarea>
        <button id="sendMessageButton">Send Message</button>
    </div>

    <div>
        <button id="callButton">Start Call</button>
        <button id="muteButton">Mute</button>
    </div>

    <script>
        const peer = new Peer();
        let currentCall;
        let isMuted = false;

        // Connect to another peer
        document.getElementById('connectButton').addEventListener('click', () => {
            const peerId = document.getElementById('peerId').value;
            const conn = peer.connect(peerId);

            conn.on('open', () => {
                console.log('Connected to peer:', peerId);
            });

            conn.on('data', (data) => {
                console.log('Received:', data);
                alert(`Received message: ${data}`);
            });

            document.getElementById('sendMessageButton').addEventListener('click', () => {
                const message = document.getElementById('messageInput').value;
                conn.send(message);
                console.log('Sent:', message);
            });
        });

        // Handle incoming calls
        peer.on('call', (call) => {
            const stream = navigator.mediaDevices.getUserMedia({ audio: true });
            call.answer(stream);

            call.on('stream', (remoteStream) => {
                const audio = new Audio();
                audio.srcObject = remoteStream;
                audio.play();
                currentCall = call;
            });
        });

        // Start a call
        document.getElementById('callButton').addEventListener('click', () => {
            const peerId = document.getElementById('peerId').value;
            const stream = navigator.mediaDevices.getUserMedia({ audio: true });
            const call = peer.call(peerId, stream);

            call.on('stream', (remoteStream) => {
                const audio = new Audio();
                audio.srcObject = remoteStream;
                audio.play();
                currentCall = call;
            });
        });

        // Mute/Unmute audio
        document.getElementById('muteButton').addEventListener('click', () => {
            if (currentCall && currentCall.peerConnection) {
                isMuted = !isMuted;
                const audioTracks = currentCall.peerConnection.getLocalStreams()[0].getAudioTracks();
                audioTracks.forEach(track => {
                    track.enabled = !isMuted;
                });
                alert(isMuted ? 'Muted' : 'Unmuted');
            } else {
                alert('No active call to mute/unmute.');
            }
        });
    </script>

</body>
</html>
